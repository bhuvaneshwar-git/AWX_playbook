Awx Documentation

AWX Operators( Anisble AWx ) via kuberenetes 
Official Documentation - https://ansible.readthedocs.io/projects/awx-operator/en/latest/installation/basic-install.html
Ansible playboook Documentation - https://medium.com/@nbkumar2103/-d81b8801763a
working link - https://mattadam.com/2024/05/01/install-awx-on-ubuntu-24/

Prerequisites - 
1) Kubernetes cluster ( minikube, kind, or k3s )
2) kubectl 
3)git
---------------------------------------------------------------------------

1) Install kuberenetes 

step 1 - # Install minikube
curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
sudo install minikube-linux-amd64 /usr/local/bin/minikube

step 2 - # Start cluster
minikube start --cpus=4 --memory=8g

step 3 - # Verify
kubectl get nodes

Note - minikube status is ready

2) Install kubectl

step 4 - curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
chmod +x kubectl
sudo mv kubectl /usr/local/bin/
kubectl version --client

3) Deploy AWX operator

step 5 - # Clone operator repo
git clone https://github.com/ansible/awx-operator.git
cd awx-operator

step 6 -# Create namespace
kubectl create ns awx

step 7 - # Deploy operator
make deploy NAMESPACE=awx

note : tro delete the pods use this command (  kubectl delete ns awx --force --grace-period=0 )

step 8 - kubectl get pods -n awx

note - check the awx-operator-controller-manager is running 

4) Deploy AWX

step 9 - Create a file awx-deploy.yaml:
apiVersion: awx.ansible.com/v1beta1
kind: AWX
metadata:
  name: awx
  namespace: awx
spec:
  service_type: NodePort
  ingress_type: none

step 10 - run the command - kubectl apply -f awx-deploy.yaml

5) Verify Pods

step 11 - kubectl get pods -n awx

Access AWX in browser

step 12 - kubectl get svc -n awx

step 13 - minikubeip: node port ex - 192.168.49.2:80

if it is not worked

step 13 - #Port forwarding 
kubectl port-forward svc/awx-service -n awx 8080:80 ( access via http://localhost:8080 )

step 14 - #inside the docker container
kubectl exec -it awx-web-d4cc6f6b9-rktkp  -n awx -- bash

step 15 - awx-manage changepassword admin ( enter your new password)

  
To start or stop the pods - kubectl port-forward svc/awx-service -n awx 8080:80 ( execute this commands) 

To start or stop the pods - 
make sure minikube is started by using check status command - minikube status( To start minikube - minikube start )
kubectl port-forward svc/awx-service -n awx 8080:80 ( execute this commands) 


official documentation for persistence storage - https://docs.ansible.com/automation-controller/4.0.0/html/administration/operator_advanced_configurations.html




ERROR -
"
â–ª docker: Not healthy: "docker version --format {{.Server.Os}}-{{.Server.Version}}:{{.Server.Platform.Name}}" exit status 1: permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get "http://%2Fvar%2Frun%2Fdocker.sock/v1.51/version": dial unix /var/run/docker.sock: connect: permission denied
    â–ª docker: Suggestion: Add your user to the 'docker' group: 'sudo usermod -aG docker $USER && newgrp docker' <https://docs.docker.com/engine/install/linux-postinstall/>
ğŸ’¡  Alternatively you could install one of these drivers:
    â–ª kvm2: Not installed: exec: "virsh": executable file not found in $PATH
    â–ª qemu2: Not installed: exec: "qemu-system-x86_64": executable file not found in $PATH
    â–ª podman: Not installed: exec: "podman": executable file not found in $PATH
    â–ª virtualbox: Not installed: unable to find VBoxManage in $PATH

âŒ  Exiting due to DRV_NOT_HEALTHY: Found driver(s) but none were healthy. See above for suggestions how to fix installed drivers.

"

solution  - 
- step 1 : sudo usermod -aG docker $USER ( grants the necessary permissions to access the Docker socket. )
- step 2 : newgrp docker
- step 3 : docker ps ( verify that you can run Docker commands without sudo )
- step 4 : minikube start 



To change the admih password - 
step 1 : kubectl get pods -n awx | grep awx-web
step 2 :  kubectl exec -it <awx-web-podname> -n awx -- bash
step 3 : awx-manage changepassword admin
step 4 : exit
step 5 : ctl + c and again start kubectl port-forward svc/awx-service -n awx 8080:80

In this step-by-step video, we will show you *how to install Ansible AWX on a Kubernetes Cluster* â€” the open-source version of **Red Hat Ansible Tower**.

By the end of this tutorial, you will have a fully functional *AWX instance* running in your Kubernetes environment.

---

### ğŸ“Œ *What is AWX?*

AWX is the upstream open-source project of Red Hat Ansible Tower.
It provides a web-based UI, REST API, and task engine for managing your Ansible automation.
It allows you to manage inventories, credentials, and jobs â€” all from a centralized dashboard.
Best of all, it's *free and open-source!*

---

### ğŸ§° *Prerequisites:*

âœ… Running Kubernetes cluster (Minikube, Kind, or Production-grade)
âœ… `kubectl` configured
âœ… Helm v3 installed
âœ… Persistent Volume support for AWX data

---

### ğŸ› ï¸ *Installation Steps Covered:*

1. Deploy AWX Operator using Helm
2. Create StorageClass & PersistentVolume
3. Create and apply AWX Custom Resource YAML
4. Extract admin credentials from Kubernetes Secret
5. Access AWX web UI and log in

---

### ğŸ“‚ *Useful Commands Covered in Video:*

# Add Helm Repo and Install AWX Operator
helm repo add awx-operator 'https://ansible-commun...â€‹
helm install ansible-awx-operator awx-operator/awx-operator -n awx --create-namespace

# Create StorageClass and PersistentVolume

cat awxstorage-class.yaml
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: local-storage
  namespace: awx
provisioner: kubernetes.io/no-provisioner
volumeBindingMode: WaitForFirstConsumer

cat awx-pv.yaml
apiVersion: v1
kind: PersistentVolume
metadata:
  name: postgres-pv
  namespace: awx
spec:
  capacity:
    storage: 10Gi
  accessModes:
ReadWriteOnce
  persistentVolumeReclaimPolicy: Retain
  storageClassName: local-storage
  hostPath:
    path: /mnt/storage

kubectl apply -f awxstorage-class.yaml
kubectl apply -f awx-pv.yaml

# Deploy AWX Instance
cat ansible-awx.yaml
apiVersion: awx.ansible.com/v1beta1
kind: AWX
metadata:
  name: ansible-awx
  namespace: awx
spec:
  service_type: nodeport
  postgres_storage_class: local-storage

kubectl apply -f ansible-awx.yaml

# Extract Admin Password
kubectl get secret ansible-awx-admin-password -o jsonpath="{.data.password}" -n awx | base64 --decode ; echo```

---

### ğŸŒ *Login to AWX Web UI*

Navigate to the NodePort exposed by your Kubernetes cluster
Username: `admin`
Password: (from the Kubernetes Secret)

---

ğŸ¯ Once inside, you can:

Add Inventories
Configure Credentials
Launch and Monitor Ansible Jobs

---

ğŸ’¡ Donâ€™t forget to configure *persistent backups**, **external databases**, and **Git/Vault integrations* for production setups!

---

ğŸ‘ If you found this tutorial helpful, please *Like**, **Subscribe**, and hit the **ğŸ”” bell icon* for more DevOps and Linux tutorials.

ğŸ’¬ Drop a comment if you'd like a follow-up video on AWX Projects, Inventories, or Job Templates!

#AnsibleAWXâ€‹ #Kubernetesâ€‹ #DevOpsâ€‹ #AnsibleTowerâ€‹ #AWXâ€‹ #LinuxTutorialâ€‹ #Helmâ€‹ #OpenSourceâ€‹ #Automationâ€‹ #RedHatAnsibleâ€‹
