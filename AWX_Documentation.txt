Awx Documentation

AWX Operators( Anisble AWx ) via kuberenetes 
Official Documentation - https://ansible.readthedocs.io/projects/awx-operator/en/latest/installation/basic-install.html
Ansible playboook Documentation - https://medium.com/@nbkumar2103/-d81b8801763a

Prerequisites - 
1) Kubernetes cluster ( minikube, kind, or k3s )
2) kubectl 
3)git
---------------------------------------------------------------------------

1) Install kuberenetes 

step 1 - # Install minikube
curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
sudo install minikube-linux-amd64 /usr/local/bin/minikube

step 2 - # Start cluster
minikube start --cpus=4 --memory=8g

step 3 - # Verify
kubectl get nodes

Note - minikube status is ready

2) Install kubectl

step 4 - curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
chmod +x kubectl
sudo mv kubectl /usr/local/bin/
kubectl version --client

3) Deploy AWX operator

step 5 - # Clone operator repo
git clone https://github.com/ansible/awx-operator.git
cd awx-operator

step 6 -# Create namespace
kubectl create ns awx

step 7 - # Deploy operator
make deploy NAMESPACE=awx

step 8 - kubectl get pods -n awx

note - check the awx-operator-controller-manager is running 

4) Deploy AWX

step 9 - Create a file awx-deploy.yaml:
apiVersion: awx.ansible.com/v1beta1
kind: AWX
metadata:
  name: awx
  namespace: awx
spec:
  service_type: NodePort
  ingress_type: none

step 10 - run the command - kubectl apply -f awx-deploy.yaml

5) Verify Pods

step 11 - kubectl get pods -n awx

Access AWX in browser

step 12 - kubectl get svc -n awx

step 13 - minikubeip: node port ex - 192.168.49.2:80

if it is not worked

step 13 - #Port forwarding 
kubectl port-forward svc/awx-service -n awx 8080:80 ( access via http://localhost:8080 )

step 14 - #inside the docker container
kubectl exec -it awx-web-d4cc6f6b9-rktkp  -n awx -- bash

step 15 - awx-manage changepassword admin ( enter your new password)

  
To start or stop the pods - kubectl port-forward svc/awx-service -n awx 8080:80 ( execute this commands) 

To start or stop the pods - 
make sure minikube is started by using check status command - minikube status( To start minikube - minikube start )
kubectl port-forward svc/awx-service -n awx 8080:80 ( execute this commands) 


official documentation for persistence storage - https://docs.ansible.com/automation-controller/4.0.0/html/administration/operator_advanced_configurations.html




ERROR -
"
‚ñ™ docker: Not healthy: "docker version --format {{.Server.Os}}-{{.Server.Version}}:{{.Server.Platform.Name}}" exit status 1: permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get "http://%2Fvar%2Frun%2Fdocker.sock/v1.51/version": dial unix /var/run/docker.sock: connect: permission denied
    ‚ñ™ docker: Suggestion: Add your user to the 'docker' group: 'sudo usermod -aG docker $USER && newgrp docker' <https://docs.docker.com/engine/install/linux-postinstall/>
üí°  Alternatively you could install one of these drivers:
    ‚ñ™ kvm2: Not installed: exec: "virsh": executable file not found in $PATH
    ‚ñ™ qemu2: Not installed: exec: "qemu-system-x86_64": executable file not found in $PATH
    ‚ñ™ podman: Not installed: exec: "podman": executable file not found in $PATH
    ‚ñ™ virtualbox: Not installed: unable to find VBoxManage in $PATH

‚ùå  Exiting due to DRV_NOT_HEALTHY: Found driver(s) but none were healthy. See above for suggestions how to fix installed drivers.

"

solution  - 
- step 1 : sudo usermod -aG docker $USER ( grants the necessary permissions to access the Docker socket. )
- step 2 : newgrp docker
- step 3 : docker ps ( verify that you can run Docker commands without sudo )
